"use strict";(("undefined"!==typeof self?self:this)["webpackChunkEditEntity"]=("undefined"!==typeof self?self:this)["webpackChunkEditEntity"]||[]).push([[446],{7446:function(t,e,i){i.r(e),i.d(e,{default:function(){return f}});var s=function(){var t=this,e=t._self._c;return e("ValidationProvider",{attrs:{name:t.fullname,rules:t.getRules()},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticClass:"d-none for-test"},[t._v("MultiSelectEntities : "+t._s(t.field.type))]),e("b-form-group",{attrs:{label:t.field.label,description:t.field.description}},[e("div",{staticClass:"autocomplete"},[e("multiselect",{attrs:{options:t.options,"custom-label":t.nameWithLang,placeholder:"",label:"text","track-by":"text","show-no-results":!0,taggable:t.auto_create,"show-labels":!1,loading:t.isLoading,multiple:t.cardinality,"allow-empty":!0},on:{"search-change":t.asyncFind,tag:t.createElement},model:{value:t.value_computed,callback:function(e){t.value_computed=e},expression:"value_computed"}},[e("template",{slot:"noResult"},[e("span",{staticClass:"option__title"},[t._v(" Aucun contenu ne correspond à votre recherche ")])]),e("template",{slot:"placeholder"},[e("span",{staticClass:"option__title"},[t._v(" Aucun contenu ... ")])]),e("template",{slot:"noOptions"},[e("span",{staticClass:"option__title"},[t._v(" Saisir un ou plusieurs caractères ... ")])])],2),e("div",{staticClass:"text-danger"},t._l(i.errors,(function(i,s){return e("small",{key:s,staticClass:"d-block"},[t._v(" "+t._s(i)+" ")])})),0)],1)])]}}])})},n=[],a=(i(3518),i(3923)),l=i(8807),r=i.n(l),d=i(8175),u=i(8007),o={name:"MultiSelectEntities",components:{ValidationProvider:a.LW,Multiselect:r()},props:{field:{type:Object,required:!0},model:{type:[Object,Array],required:!0},namespaceStore:{type:String,required:!0},parentName:{type:String,required:!0},overrideConfig:{type:Boolean,default:!1}},data(){return{isLoading:!1,options:[],value_select:null}},computed:{fullname(){return this.parentName+this.field.name},cardinality(){return-1===this.field.cardinality},auto_create(){return this.field.definition_settings.handler_settings.auto_create},value_computed:{get(){return this.value_select},set(t){this.updateValue(t)}}},mounted(){this.loadDefaults(),this.asyncFind("",!0)},methods:{getTermById(t){let e=this.getFistVocab();if(e&&u.A.config){const i=this.field.definition_settings.bundle_entity_type_id?this.field.definition_settings.bundle_entity_type_id:e,s=new d.A(e,i,u.A.config);this.overrideConfig&&(s.remplaceConfig(),console.log("getTermById :::",this.overrideConfig)),this.isLoading=!0,s.getValueById(t).then((()=>{const t=s.getOptions();t[0]&&(this.options.push(t[0]),this.cardinality?this.value_select.push(t[0]):t[0]&&(this.value_select=t[0])),this.isLoading=!1})).catch((()=>{this.isLoading=!1}))}},loadDefaults(){this.value_select=[],this.model[this.field.name].forEach((t=>{this.getTermById(t.target_id)}))},getFistVocab(){if(this.field.definition_settings.handler_settings.target_bundles){const t=Object.keys(this.field.definition_settings.handler_settings.target_bundles);return this.field.definition_settings.handler_settings.target_bundles[t[0]]}return this.field.definition_settings.target_type?this.field.definition_settings.target_type:null},asyncFind(t,e=!1){if(t.length>=2||e){let e=this.getFistVocab();if(e&&u.A.config){const i=this.field.definition_settings.bundle_entity_type_id?this.field.definition_settings.bundle_entity_type_id:e,s=new d.A(e,i,u.A.config);this.overrideConfig&&s.remplaceConfig(),this.isLoading=!0,s.getSearch(t).then((()=>{this.options=s.getOptions(),this.isLoading=!1})).catch((t=>{this.isLoading=!1,console.log(t)}))}}},createElement(t){const e={value:{name:t},entity_type_id:this.field.definition_settings.target_type},i=this.namespaceStore?this.namespaceStore+"/saveEntity":"saveEntity";this.$store.dispatch(i,e).then((e=>{this.value_select.push({text:t,value:e.data.id}),this.updateValue(this.value_select)})).catch((t=>console.log("error: ",t)))},nameWithLang({text:t}){return`${t}`},setValue(t){this.namespaceStore?this.$store.dispatch(this.namespaceStore+"/setValue",{value:t,fieldName:this.fullname}):this.$store.dispatch("setValue",{value:t,fieldName:this.fullname})},getRules(){return u.A.getRules(this.field)},updateValue(t){if(this.value_select=t,this.cardinality){const e=[];t&&t.length&&t.forEach((t=>{e.push({target_id:t.value})})),this.setValue(e)}else{const e=[];t&&t.value&&e.push({target_id:t.value}),this.setValue(e)}}}},h=o,c=i(1656),_=(0,c.A)(h,s,n,!1,null,null,null),f=_.exports},8175:function(t,e,i){i(3491);var s=i(4802),n=i(7899),a=i(5606);class l{constructor(t,e=null,i=null){this.entity_type_id=t,this.bundle=e,e||(this.bundle=t),this.url=n.A.baseURl+"/"+this.entity_type_id+"/"+e,this.items=[],this.newConfig=i,i&&i.TestDomain&&(s.A.TestDomain=i.TestDomain),this.filterQuery="",this.fields=[]}get(){return new Promise(((t,e)=>{this.filterQuery&&(this.filterQuery=this.url.includes("?")?"&"+this.filterQuery:"?"+this.filterQuery),s.A.dGet(this.url+this.filterQuery+this.addFieldsToQuery(),n.A.headers).then((e=>{this.items=e.data,t(e.data)})).catch((t=>{e(t)}))}))}getColumnName(){switch(this.entity_type_id){case"webform":return"title";default:return"name"}}getSearch(t){const e=new a.A;return e.addFilter(this.getColumnName(),"CONTAINS",t),new Promise(((t,i)=>{s.A.dGet(this.url+"?"+e.query,n.A.headers).then((e=>{this.items=e.data,t(e.data)})).catch((t=>{i(t)}))}))}getValue(t){const e=new a.A;return e.addFilter(this.getColumnName(),"=",t),new Promise(((t,i)=>{s.A.dGet(this.url+"?"+e.query,n.A.headers).then((e=>{this.items=e.data,t(e.data)})).catch((t=>{i(t)}))}))}getValueByTid(t){const e=new a.A;return e.addFilter("tid","=",t),new Promise(((t,i)=>{s.A.dGet(this.url+"?"+e.query,n.A.headers).then((e=>{this.items=e.data,t(e.data)})).catch((t=>{i(t)}))}))}getValueById(t){const e=new a.A;let i="drupal_internal__id";switch(this.entity_type_id){case"user":i="uid";break;case"node":i="drupal_internal__nid";break;case"taxonomy_term":i="tid";break}return e.addFilter(i,"=",t),new Promise((t=>{s.A.dGet(this.url+"?"+e.query,n.A.headers).then((e=>{this.items=e.data,t(e.data)}))}))}filter(t,e,i){const s=new a.A;s.addFilter(t,e,i),s.query&&(this.filterQuery?this.filterQuery+="&"+s.query:this.filterQuery+=s.query)}addIncludesEntities(t=[]){}getOptions(){const t=[];for(const e in this.items.data){const i=this.items.data[e];"user"==this.entity_type_id?t.push({text:i.attributes.name?i.attributes.name:i.attributes.display_name,value:i.attributes.drupal_internal__uid}):i.attributes.title?t.push({text:i.attributes.title,value:i.attributes.drupal_internal__id}):i.attributes.name?t.push({text:i.attributes.name,value:i.attributes.drupal_internal__id}):i.attributes.label&&t.push({text:i.attributes.label,value:i.attributes.drupal_internal__id})}return t}addFieldsToQuery(){var t="";return this.fields.length>0&&(t+="&fields["+this.entity_type_id+"--"+this.bundle+"]",t+="="+this.fields.toString()),t}setFields(t){this.fields=t}remplaceConfig(){for(const t in this.newConfig)s.A[t]=this.newConfig[t]}}e.A=l}}]);
//# sourceMappingURL=EditEntity.umd.min.446.js.map